name: Deploy Telegram Bot

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  test-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        pip install python-telegram-bot
    
    - name: Check files
      run: |
        echo "Files in repository:"
        ls -la
        echo ""
        echo "Checking config.json..."
        if [ -f "config.json" ]; then
          echo "✅ config.json exists"
          cat config.json
        else
          echo "❌ config.json missing"
          # Create minimal config for testing
          echo '{"telegram": {"bot_token": "test_token", "allowed_user_ids": [123]}}' > config.json
        fi
    
    - name: Test bot startup
      run: |
        echo "Testing bot startup..."
        # Run bot for 5 seconds to test it starts
        timeout 5 python telegram_bot.py &
        sleep 3
        echo "✅ Bot test completed"